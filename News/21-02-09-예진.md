#### [기사 1]

# 인터넷이 지구 반대편을 연결하는 방법 : BGP의 개념과 동작 원리

링크 :  [https://www.itworld.co.kr/news/181614](https://www.itworld.co.kr/news/181614)

<br>

##### 지구 반대편으로 가는 최선의 경로? BGP(Border Gateway Protocol) 사용!

글로벌 인터넷에 사용되는 라우팅 프로토콜인 BGP(Border Gateway Protocol)를 사용해서 도달 가능성과 라우팅 정보를 기반으로 최신 네트워크 조건을 평가해 최선의 경로를 찾을 수 있다. 

<br>

### 경계 게이트웨이 프로토콜이란?  

IETF의 정의에 따르면 BGP의 주 기능은 “**다른 BGP 시스템과 네트워크 도달 가능성 정보를 교환하는 것**”이다. 

BGP는 원활하게 작동하면서 이런 개별 시스템이 상호 연계해 인터넷을 형성하도록 한다. 

#### *교재 1-4. 인터넷에 나오는 부분과 중복*

##### 인터넷

> 네트워크의 네트워크라고 한다. 

##### 자율 시스템(Autonomous System, AS)

> 인터넷에서 서로 연결되는 대규모 조직이 관리하는 개별 네트워크로 구성된 그룹
>
> => 인터넷에서 서로 연결되는 개별 네트워크 그룹

AS가 있는 대규모 조직으로는 ISP(Internet Service Provider), 대규모 정부기관, 대학, 과학기관 등이 포함된다. 

##### ISP는 자체 AS내의 트래픽을 처리 

각 AS는 네트워크 내에서 트래픽이 이동하는 방법에 관한 규칙과 정책을 만든다.

ISP는 자체 AS 내에의 다른 노드를 오가는 트래픽을 처리한다.

##### BGP는 AS 외부와 접속 시 개입 & BGP 라우터는 다른 AS가 알 수 있도록 IP 주소의 prefix 광고

자체 AS 너머에 있는 사이트에 액세스하려고 시도하는 경우에는 BGP가 개입한다. 

AS 조직은 조직 간에 트래픽이 이동할 수 있도록 하는 피어링(Peering) 계약을 맺는다. 

AS 네트워크 엣지의 BGP 라우터는 피어에 트래픽을 전달할 수 있는 IP 주소의 프리픽스(prefix)를 ‘광고’ 

=> 다른 AS가 알 수 있도록 널리 알린다.  (라우팅 테이블을 업데이트 시 정기적으로 prefix 선언함)

<br>

### AS 간의 피어링 계약 

BGP 라우터 프리픽스 선언 => 수집 데이터 분석 =>  각 패킷 스트림을 보낼 최적의 피어 선택 => 다른 AS에 연결된 BGP라우터에 도달

=> 대부분 네트워크 홉의 수가 가장 적은 경로가 선택

=> 여러 BGP 라우터 거쳐서 **데이터가 목적지 사이트가 위치한 AS에 도달할 때까지 반복** 



#####  컴퓨터, 전화기 및 기타 디바이스는 인터넷에 연결하려면..?

ISP 사용 => 인터넷 백본에 액세스할 때까지 계속해서 더 큰 ISP 네트워크에 연결 =>  인터넷 백본까지 올라감 => 목적지 IP 주소를 향함

이 과정에서 BGP를 AS 내의 라우팅에도 사용한다면 iBGP(Interior Border Gateway Protocol)라고 한다.  (대안 있으므로 필수X)

##### 다른 ISP와 라우팅 정보 교환하기 위해 AS 번호(ASN) 사용

- 자체 네트워크 내의 라우팅을 제어하고 다른 ISP와 라우팅 정보를 교환하는 데 사용

- ASN은 인터넷 할당 번호 관리 기관(IANA)에 의해 할당됨

- 지역 인터넷 레지스트리를 통해 ISP와 기타 네트워크 운영자에 배포

- IP 주소와 마찬가지로 ASN에도 16비트(2바이트)와 32비트(4바이트) 번호가 포함

<br>

### BGP 하이재킹이란? 라우팅 테이블 조작해서 악성 서버 연결

각 AS는 자사가 소유한 IP 주소와 공유하는 라우팅 정보를 제공 & BGP는 이 정보를 진실이라고 가정 =>  **BGP 하이재킹 문제 발생 원인**

> 공격자

공격자는 라우터가 **자신에게 할당되지 않은 프리픽스를 광고하도록 BGP 라우팅 테이블을 조작**한다. 

이러한 위조 광고에 따라 트래픽이 그 경로로 이동 => 인증 정보를 훔치고 맬웨어를 다운로드 등 악성 서버로 연결

>  최종 사용자

최종 사용자는 합법적인 사이트를 방문 중이라고 생각함

<br>

### BGP 하이재킹 대처 방법 

- 악성 네트워크에서 오는 인바운드 네트워크 트래픽을 차단하는 **IP 주소 프리픽스 필터링**을 사용

- **BGP 하이재킹 탐지 모니터링** :  지연의 증가, 성능 하락 또는 잘못된 인터넷 트래픽 등 하이재킹 시도 징후 감시 

- **BGPsec ** : 광고된 경로에 대해 암호화 검증 & 백본 라우터가 경로 업데이트 광고에 디지털 서명을 적용하는 보안 확장 프로그램

  => 승인되지 않은 공격자가 AS에 대한 악성 경로를 광고하기가 더 어렵게 되고 잘못된 구성도 차단됨

  => 이 방법을 구현하기 위해서는 전체 인터넷이 거의 동시에 이를 채택해야 한다 => 어렵다.. 

<br>

### MANRS  : BGP를 보호하기 위한 필터와 암호화를 채택

2020년 9월, MANRS(Mutually Agreed Norms for Routing Security)라는 단체가 콘텐츠 전송 네트워크와 기타 클라우드 서비스에서 BGP를 보호하기 위한 필터와 암호화를 채택하도록 돕는 태스크 포스를 구성했다. 

2014년에 설립된 이 단체는 6가지 보안 강화 조치로 정의되는 라우팅 보안의 기반을 추구하는데, 그중 5가지는 의무적 구현 항목

- 부정확한 라우팅 정보 전파 차단 
- 불법적 소스 IP 주소를 가진 트래픽 차단 
- 글로벌 운영 커뮤니케이션 및 조율 촉진 
- 글로벌 규모의 라우팅 정보 검증 촉진 
- MANRS 도입 장려 
- 피어링 파트너에게 모니터링 및 디버깅 툴 제공(선택) 

MANRS는 암호화 서명되어 신뢰성을 입증하는 공공 경로 데이터베이스인 **라우팅 공개키 인프라(RPKI) 사용을 권장**한다. 
RPKI 사용자는 제안하는 경로를 게시하고 데이터베이스를 확인해 다른 사용자의 경로를 확인

=> 누출과 중단을 완전히 없애려면 모두가 이를 사용해야 한다. 

=> 그렇지 않은 경우 BGP 라우터는 검증되지 않은 광고를 수락할 수밖에 없다. 